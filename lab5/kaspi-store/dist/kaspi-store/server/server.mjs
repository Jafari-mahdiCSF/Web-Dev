import { createRequire } from 'node:module';
globalThis['require'] ??= createRequire(import.meta.url);
import{a as P,c as b,d as N,e as d,f as S}from"./chunk-C4JYV7QC.mjs";var E=b(()=>{"use strict"});var l={};N(l,{AngularAppEngine:()=>g,default:()=>q});import G from"./angular-app-engine-manifest.mjs";var w=new Set(["host","x-forwarded-host"]),I=/^\d+$/,M=/^https?$/i,O=/^[a-z0-9.:-]+$/i,H=/^[/\\]{2}|(?:^|[/\\])\.\.?(?:[/\\]|$)/;function h(o){return o?.toString().split(",",1)[0]?.trim()}function A(o,e){U(o),$(new URL(o.url),e)}function $(o,e){let{hostname:t}=o;if(!y(t,e))throw new Error(`URL with hostname "${t}" is not allowed.`)}function C(o,e){let t,r=new Promise(a=>{t=a}),n=new Request(o.clone(),{signal:o.signal}),s=n.headers,i=s.get;s.get=function(a){let c=i.call(s,a);return c&&(m(a,c,e,t),c)};let u=s.values;s.values=function(){for(let a of w)m(a,i.call(s,a),e,t);return u.call(s)};let f=s.entries;return s.entries=function(){let a=f.call(s);return{next(){let c=a.next();if(!c.done){let[x,_]=c.value;m(x,_,e,t)}return c},[Symbol.iterator](){return this}}},s[Symbol.iterator]=s.entries,{request:n,onError:r}}function m(o,e,t,r){if(e&&w.has(o.toLowerCase()))try{D(o,e,t)}catch(n){throw r(n),n}}function D(o,e,t){let r=h(e);if(!r)return;let n=`http://${r}`;if(!URL.canParse(n))throw new Error(`Header "${o}" contains an invalid value and cannot be parsed.`);let{hostname:s}=new URL(n);if(!y(s,t))throw new Error(`Header "${o}" with value "${r}" is not allowed.`)}function y(o,e){if(e.has(o))return!0;for(let t of e){if(!t.startsWith("*."))continue;let r=t.slice(1);if(o.endsWith(r))return!0}return!1}function U(o){let e=o.headers;for(let s of w){let i=h(e.get(s));if(i&&!O.test(i))throw new Error(`Header "${s}" contains characters that are not allowed.`)}let t=h(e.get("x-forwarded-port"));if(t&&!I.test(t))throw new Error('Header "x-forwarded-port" must be a numeric value.');let r=h(e.get("x-forwarded-proto"));if(r&&!M.test(r))throw new Error('Header "x-forwarded-proto" must be either "http" or "https".');let n=h(e.get("x-forwarded-prefix"));if(n&&H.test(n))throw new Error('Header "x-forwarded-prefix" must not start with multiple "/" or "\\" or contain ".", ".." path segments.')}var R;function L(o){R=o}function V(){if(!R)throw new Error("Angular app engine manifest is not set. Please ensure you are using the '@angular/build:application' builder to build your server application.");return R}function j(o){return o[0]==="/"?o:`/${o}`}function F(...o){let e=[];for(let t of o){if(t==="")continue;let r=0,n=t.length;for(;r<n&&t[r]==="/";)r++;for(;n>r&&t[n-1]==="/";)n--;r<n&&e.push(t.slice(r,n))}return j(e.join("/"))}var p=(function(o){return o[o.Server=0]="Server",o[o.Client=1]="Client",o[o.Prerender=2]="Prerender",o})(p||{});var v=class{store=new Map;async run(e,t){let r=this.store.get(e);switch(e){case"html:transform:pre":{if(!r)return t.html;let n=P({},t);for(let s of r)n.html=await s(n);return n.html}default:throw new Error(`Running hook "${e}" is not supported.`)}}on(e,t){let r=this.store.get(e);r?r.push(t):this.store.set(e,[t])}has(e){return!!this.store.get(e)?.length}};var Y={[p.Prerender]:"ssg",[p.Server]:"ssr",[p.Client]:""};function k(o,e){let{pathname:t}=o,r=e.length;t[r]==="/"&&r++;let n=t.indexOf("/",r);return n===-1&&(n=t.length),t.slice(r,n)}function W(o){if(o==="*")return new Map([["*",1]]);let e=o.split(",").map(t=>{let[r,n]=t.split(";",2).map(i=>i.trim()),s=n?.startsWith("q=")?parseFloat(n.slice(2)):void 0;return(typeof s!="number"||isNaN(s)||s<0||s>1)&&(s=1),[r,s]}).sort(([t,r],[n,s])=>s-r);return new Map(e)}function B(o,e){if(e.length<2)return e[0];let t=W(o);if(t.size===0||t.size===1&&t.has("*"))return e[0];let r=new Map;for(let i of e)r.set(T(i),i);let n,s=new Set;for(let[i,u]of t){let f=T(i);if(u===0){s.add(f);continue}if(r.has(f))return r.get(f);if(n!==void 0)continue;let[a]=f.split("-",1);for(let c of r.keys())if(c.startsWith(a)){n=r.get(c);break}}if(n!==void 0)return n;for(let[i,u]of r)if(!s.has(i))return u}function T(o){return o.toLowerCase()}var g=class o{static \u0275allowStaticRouteRender=!1;static \u0275hooks=new v;manifest=V();allowedHosts;supportedLocales=Object.keys(this.manifest.supportedLocales);entryPointsCache=new Map;constructor(e){this.allowedHosts=new Set([...e?.allowedHosts??[],...this.manifest.allowedHosts])}async handle(e,t){let r=this.allowedHosts;try{A(e,r)}catch(u){return this.handleValidationError(u,e)}let{request:n,onError:s}=C(e,r),i=await this.getAngularServerAppForRequest(n);return i?Promise.race([s.then(u=>this.handleValidationError(u,n)),i.handle(n,t)]):this.supportedLocales.length>1?this.redirectBasedOnAcceptLanguage(e):null}redirectBasedOnAcceptLanguage(e){let{basePath:t,supportedLocales:r}=this.manifest,{pathname:n}=new URL(e.url);if(n!==t)return null;let s=B(e.headers.get("Accept-Language")||"*",this.supportedLocales);if(s){let i=r[s];if(i!==void 0)return new Response(null,{status:302,headers:{Location:F(n,i),Vary:"Accept-Language"}})}return null}async getAngularServerAppForRequest(e){let t=new URL(e.url),r=await this.getEntryPointExportsForUrl(t);if(!r)return null;let n=r.\u0275getOrCreateAngularServerApp;return n({allowStaticRouteRender:o.\u0275allowStaticRouteRender,hooks:o.\u0275hooks})}getEntryPointExports(e){let t=this.entryPointsCache.get(e);if(t)return t;let{entryPoints:r}=this.manifest,n=r[e];if(!n)return;let s=n();return this.entryPointsCache.set(e,s),s}getEntryPointExportsForUrl(e){let{basePath:t,supportedLocales:r}=this.manifest;if(this.supportedLocales.length===1)return this.getEntryPointExports(r[this.supportedLocales[0]]);let n=k(e,t);return this.getEntryPointExports(n)??this.getEntryPointExports("")}async handleValidationError(e,t){let r=this.allowedHosts.size>0,n=e.message;return console.error(`ERROR: Bad Request ("${t.url}").
`+n+(r?"":`
Falling back to client side rendering. This will become a 400 Bad Request in a future major version.`)+`

For more information, see https://angular.dev/best-practices/security#preventing-server-side-request-forgery-ssrf`),r?new Response(n,{status:400,statusText:"Bad Request",headers:{"Content-Type":"text/plain"}}):(await this.getAngularServerAppForRequest(t))?.serveClientSidePage()??null}};L(G);var z=S(E());d(l,S(E()));var X="default",q=z[X];export{g as AngularAppEngine,q as default};
